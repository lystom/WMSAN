<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Body Wave - WMSAN</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Body Wave";
        var mkdocs_page_input_path = "api_overview/body_waves.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../img/logowmsan.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../getting_started/">Getting Started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API Overview</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api_overview/">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../read_hs_p2l/">Read WW3 Files</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Body Wave</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../rayleigh_waves/">Rayleigh Wave</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../temporal_variations/">Temporal Variations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../synthetics/">Synthetic Cross-Correlation Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wmsan_to_noisi/">To noisi</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../user_guide/">Tutorials</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Site Effect</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/amplification_coeff/">Rayleigh Waves Site Effect</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/body_waves/amplification_coeff/">Body Waves Site Effect</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Equivalent Vertical Force Maps</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/microseismic_sources/">Rayleigh Waves Equivalent Vertical Force</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/body_waves/microseismic_sources/">Body Waves Equivalent Vertical Force</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../notebooks/rayleigh_waves/temporal_variations/">Rayleigh Waves Temporal Variations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Synthetic Cross-Correlation Functions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/synthetic_CCF/">Rayleigh Waves Synthetic Cross-correlation Functions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/body_waves/synthetic_CCF/">Body Waves Synthetics Cross-correlation Functions</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../notebooks/rayleigh_waves/wmsan_to_noisi/">WMSAN to noisi</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Synthetic Spectrograms</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/rayleigh_source/">Rayleigh Waves Power Spectrum of Vertical Displacement</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/spectrograms/">Rayleigh Waves Synthetic Spectrograms</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer_guide/">How to contribute ?</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">WMSAN</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Overview</li>
      <li class="breadcrumb-item active">Body Wave</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="body-waves">Body Waves</h2>


<div class="doc doc-object doc-module">



<a id="wmsan.subfunctions_body_waves"></a>
    <div class="doc doc-contents first">

      <p>This set of functions aims at modeling the ambient noise source in the secondary microseismic range for Rayleigh waves.
Using Longuet-Higgins site effect and WAVEWATCHIII model.</p>
<p>It contains six functions:</p>
<ul>
<li>
<p><code>download_ww3_local(YEAR, MONTH, ftp_path_to_files, ww3_local_path, prefix)</code>: download the WW3 files for the given month.</p>
</li>
<li>
<p><code>open_bathy(file_bathy, refined_bathymetry, extent)</code>: open the bathymetry file. Either default WW3 grid, ETOPOv2 or a custom grid.</p>
</li>
<li>
<p><code>subfctn_liquid_solid(p, mi, mt)</code>: compute the reflection and transmission coefficients between two media.</p>
</li>
<li>
<p><code>bathy(z, f, p, m)</code>: compute the amplification coefficient for P and S waves.</p>
</li>
<li>
<p><code>ampli(dpt1, f, rp, layers, theta)</code>: compute the amplification coefficient for P and S waves.</p>
</li>
<li>
<p><code>loop_ww3_sources(paths, dpt1, zlon, zlat, wave_type, date_vec, extent, parameters, c_file, prefix, **kwargs)</code>: compute the equivalent vertical force.</p>
</li>
</ul>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_body_waves.ampli" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ampli</span><span class="p">(</span><span class="n">dpt1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rp</span><span class="o">=</span><span class="p">[],</span> <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5540</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">2500</span><span class="p">],</span> <span class="n">theta</span><span class="o">=</span><span class="n">radians</span><span class="p">(</span><span class="mf">15.71</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Compute amplification coefficient for P and S waves. </p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>dpt1</code></b>
                  (<code>ndarray</code>)
              –
              <div class="doc-md-description">
                <p>bathymetry grid in meters</p>
              </div>
            </li>
            <li>
              <b><code>f</code></b>
                  (<code>ndarray</code>)
              –
              <div class="doc-md-description">
                <p>frequency vector in Hz</p>
              </div>
            </li>
            <li>
              <b><code>rp</code></b>
                  (<code>ndarray</code>, default:
                      <code>[]</code>
)
              –
              <div class="doc-md-description">
                <p>ray parameter matrix to integrate over. </p>
              </div>
            </li>
            <li>
              <b><code>layers</code></b>
                  (<code>list</code>, default:
                      <code>[1500, 1000, 5540, 3200, 2500]</code>
)
              –
              <div class="doc-md-description">
                <p>layers properties [Vp_w, rho_w, Vp_c, Vs_c, rho].</p>
              </div>
            </li>
            <li>
              <b><code>theta</code></b>
                  (<code>float</code>, default:
                      <code><span title="math.radians">radians</span>(15.71)</code>
)
              –
              <div class="doc-md-description">
                <p>limit angle of. Defaults to radians(15.71).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>cP</code></b>(                  <code>ndarray</code>
)              –
              <div class="doc-md-description">
                <p>Amplification coefficient for P waves.</p>
              </div>
            </li>
            <li>
<b><code>cS</code></b>(                  <code>ndarray</code>
)              –
              <div class="doc-md-description">
                <p>Amplification coefficient for S waves.</p>
              </div>
            </li>
            <li>
<b><code>bathy_ampli_P</code></b>(                  <code>ndarray</code>
)              –
              <div class="doc-md-description">
                <p>Amplification coefficient for P waves divided by theta.</p>
              </div>
            </li>
            <li>
<b><code>bathy_ampli_S</code></b>(                  <code>ndarray</code>
)              –
              <div class="doc-md-description">
                <p>Amplification coefficient for S waves divided by theta.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_body_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ampli</span><span class="p">(</span><span class="n">dpt1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rp</span><span class="o">=</span><span class="p">[],</span> <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5540</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">2500</span><span class="p">],</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">15.71</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute amplification coefficient for P and S waves. </span>

<span class="sd">    Args:</span>
<span class="sd">        dpt1 (ndarray): bathymetry grid in meters</span>
<span class="sd">        f (ndarray): frequency vector in Hz</span>
<span class="sd">        rp (ndarray, optional): ray parameter matrix to integrate over. </span>
<span class="sd">        layers (list, optional): layers properties [Vp_w, rho_w, Vp_c, Vs_c, rho].</span>
<span class="sd">        theta (float, optional): limit angle of. Defaults to radians(15.71).</span>

<span class="sd">    Returns:</span>
<span class="sd">        cP (ndarray): Amplification coefficient for P waves.</span>
<span class="sd">        cS (ndarray): Amplification coefficient for S waves.</span>
<span class="sd">        bathy_ampli_P (ndarray): Amplification coefficient for P waves divided by theta.</span>
<span class="sd">        bathy_ampli_S (ndarray): Amplification coefficient for S waves divided by theta.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute amplification for Tp and rp following G14</span>
    <span class="p">(</span><span class="n">cP</span><span class="p">,</span> <span class="n">cS</span><span class="p">)</span> <span class="o">=</span> <span class="n">bathy</span><span class="p">(</span><span class="n">dpt1</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rp</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">cP</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cP</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">cS</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cS</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">bathy_ampli_P</span> <span class="o">=</span> <span class="n">cP</span><span class="o">/</span><span class="n">theta_lim</span>
        <span class="n">bathy_ampli_S</span> <span class="o">=</span> <span class="n">cS</span><span class="o">/</span><span class="n">theta_lim</span>
        <span class="k">return</span> <span class="n">cP</span><span class="p">,</span> <span class="n">cS</span><span class="p">,</span> <span class="n">bathy_ampli_P</span><span class="p">,</span> <span class="n">bathy_ampli_S</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_cP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">new_cS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>
            <span class="n">new_cP</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cP</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="n">new_cS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cS</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">bathy_ampli_P</span> <span class="o">=</span> <span class="n">new_cP</span><span class="o">/</span><span class="n">theta</span>
        <span class="n">bathy_ampli_S</span> <span class="o">=</span> <span class="n">new_cS</span><span class="o">/</span><span class="n">theta</span>
        <span class="k">return</span> <span class="n">new_cP</span><span class="p">,</span> <span class="n">new_cS</span><span class="p">,</span> <span class="n">bathy_ampli_P</span><span class="p">,</span> <span class="n">bathy_ampli_S</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_body_waves.bathy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bathy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[],</span> <span class="n">m</span><span class="o">=</span><span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">55400</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">2500</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Bathymetry secondary microseismic excitation coefficients(for P,S amplitude).
Based on LI Lei, ll.ynyf@gmail.com modified by Pierre Boue 23/11/2020</p>


<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">25000</span><span class="p">,</span> <span class="mi">5001</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cP</span><span class="p">,</span> <span class="n">cS</span> <span class="o">=</span> <span class="n">bathy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">z</span><span class="o">/</span><span class="mi">1500</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cP</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cS</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>z</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>thickness of water layer in meters, if z in m|km, v should be in m/s|km/s. All rhos must keep the same units.</p>
              </div>
            </li>
            <li>
              <b><code>f</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>seismic frequency in Hz</p>
              </div>
            </li>
            <li>
              <b><code>p</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>, default:
                      <code>[]</code>
)
              –
              <div class="doc-md-description">
                <p>slowness, if not specified return p values integral to 1/vp_crust</p>
              </div>
            </li>
            <li>
              <b><code>m</code></b>
                  (<code>list</code>, default:
                      <code>[1500, 1000, 55400, 3200, 2500]</code>
)
              –
              <div class="doc-md-description">
                <p>[vp_water, rho_water, vp_crust, vs_crust, rho_crust]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>cP</code></b>(                  <code><span title="numpy.ndarray">ndarray</span></code>
)              –
              <div class="doc-md-description">
                <p>excitation coefficients of P waves in shape of [[p,]f, z]</p>
              </div>
            </li>
            <li>
<b><code>cS</code></b>(                  <code><span title="numpy.ndarray">ndarray</span></code>
)              –
              <div class="doc-md-description">
                <p>excitation coefficients of S waves in shape of [[p,]f, z]</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_body_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bathy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[],</span> <span class="n">m</span><span class="o">=</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">55400</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="mi">2500</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Bathymetry secondary microseismic excitation coefficients(for P,S amplitude).</span>
<span class="sd">    Based on LI Lei, ll.ynyf@gmail.com modified by Pierre Boue 23/11/2020</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; z = np.linspace(0, 25000, 5001)</span>
<span class="sd">        &gt;&gt;&gt; f = 1/8</span>
<span class="sd">        &gt;&gt;&gt; cP, cS = bathy(z, f, [], [])</span>
<span class="sd">        &gt;&gt;&gt; x = f*z/1500</span>
<span class="sd">        &gt;&gt;&gt; plt.figure()</span>
<span class="sd">        &gt;&gt;&gt; plt.plot(x, abs(cP[0]), x, abs(cS[0]))</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">    Args:</span>
<span class="sd">        z (np.ndarray): thickness of water layer in meters, if z in m|km, v should be in m/s|km/s. All rhos must keep the same units.</span>
<span class="sd">        f (np.ndarray): seismic frequency in Hz</span>
<span class="sd">        p (np.ndarray, optional): slowness, if not specified return p values integral to 1/vp_crust</span>
<span class="sd">        m (list, optional): [vp_water, rho_water, vp_crust, vs_crust, rho_crust]</span>

<span class="sd">    Returns:</span>
<span class="sd">        cP (np.ndarray): excitation coefficients of P waves in shape of [[p,]f, z]</span>
<span class="sd">        cS (np.ndarray): excitation coefficients of S waves in shape of [[p,]f, z]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##</span>
    <span class="p">(</span><span class="n">rhow</span><span class="p">,</span> <span class="n">rhoc</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># in kg/m³</span>
    <span class="p">(</span><span class="n">vpw</span><span class="p">,</span> <span class="n">vpc</span><span class="p">,</span> <span class="n">vsc</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># in m/s</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">vpw</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">rhow</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">vpc</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">vsc</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">rhoc</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>

    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="p">(</span><span class="n">vpw</span><span class="p">,</span> <span class="n">rhow</span><span class="p">,</span> <span class="n">vpc</span><span class="p">,</span> <span class="n">vsc</span><span class="p">,</span> <span class="n">rhoc</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">5.54</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[rho_w, rho_c] = [1, 2.5] g/cm³&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[vpw, vpc, vsc] = [1.5, 5.54, 3.2] km/s&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span><span class="o">/</span><span class="n">vpc</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vpw</span><span class="p">,</span> <span class="n">rhow</span><span class="p">,</span> <span class="n">vpc</span><span class="p">,</span> <span class="n">vsc</span><span class="p">,</span> <span class="n">rhoc</span><span class="p">])</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">vpw</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
        <span class="n">cP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
        <span class="n">cS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">c_P</span><span class="p">,</span> <span class="n">c_S</span> <span class="o">=</span> <span class="n">bathy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c_P</span><span class="p">,</span> <span class="n">c_S</span> <span class="o">=</span> <span class="n">bathy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="n">cP</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cP</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c_P</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">cS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c_S</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="n">cP</span><span class="p">,</span> <span class="n">cS</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">csqrt</span><span class="p">(</span><span class="n">cP</span><span class="p">),</span> <span class="n">csqrt</span><span class="p">(</span><span class="n">cS</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cP</span><span class="p">,</span> <span class="n">cS</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.995</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span><span class="o">/</span><span class="n">vpc</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">c_P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
        <span class="n">c_P</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">c_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
        <span class="n">c_S</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">cP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
        <span class="n">cS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
        <span class="n">Rpp</span><span class="p">,</span> <span class="n">Tpp</span><span class="p">,</span> <span class="n">Tps</span> <span class="o">=</span> <span class="n">subfcn_liquid_solid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">[</span><span class="n">vpw</span><span class="p">,</span> <span class="n">rhow</span><span class="p">],</span> <span class="p">[</span><span class="n">vpc</span><span class="p">,</span> <span class="n">vsc</span><span class="p">,</span> <span class="n">rhoc</span><span class="p">])</span>
        <span class="n">qw</span> <span class="o">=</span> <span class="n">csqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vpw</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Rpp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">phi</span><span class="o">*</span><span class="n">qw</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">c_P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tpp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span> 
                <span class="n">c_S</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>
                <span class="n">c_Pi</span><span class="p">,</span> <span class="n">c_Si</span> <span class="o">=</span> <span class="n">bathy</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                <span class="n">c_P</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">c_Pi</span>
                <span class="n">c_S</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">c_Si</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">))):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">vpw</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
                <span class="n">cP</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cP</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c_P</span><span class="p">[:,</span><span class="n">i</span><span class="p">,:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">cS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c_S</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">(</span><span class="n">cP</span><span class="p">,</span> <span class="n">cS</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">cP</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">cS</span><span class="p">))</span>
    <span class="n">Rpp</span><span class="p">,</span> <span class="n">Tpp</span><span class="p">,</span> <span class="n">Tps</span> <span class="o">=</span> <span class="n">subfcn_liquid_solid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="p">[</span><span class="n">vpw</span><span class="p">,</span> <span class="n">rhow</span><span class="p">],</span> <span class="p">[</span><span class="n">vpc</span><span class="p">,</span> <span class="n">vsc</span><span class="p">,</span> <span class="n">rhoc</span><span class="p">])</span>
    <span class="n">qw</span> <span class="o">=</span> <span class="n">csqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vpw</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">cP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">z</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex_&quot;</span><span class="p">)</span>
    <span class="n">cP</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">cS</span> <span class="o">=</span> <span class="n">cP</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">Rpp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">phi</span><span class="o">*</span><span class="n">qw</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">cP</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tpp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span>  
        <span class="n">cS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Tps</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">C</span><span class="p">)</span>
    <span class="p">(</span><span class="n">cP</span><span class="p">,</span> <span class="n">cS</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">cP</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">cS</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cP</span><span class="p">,</span> <span class="n">cS</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_body_waves.download_ww3_local" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_ww3_local</span><span class="p">(</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">MONTH</span><span class="p">,</span> <span class="n">ftp_path_to_files</span><span class="o">=</span><span class="s1">&#39;ftp://ftp.ifremer.fr/ifremer/dataref/ww3/GLOBMULTI_ERA5_GLOBCUR_01/GLOB-30M/2020/FIELD_NC/&#39;</span><span class="p">,</span> <span class="n">ww3_local_path</span><span class="o">=</span><span class="s1">&#39;../../data/ww3/&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;WW3-GLOB-30M&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Download WW3 files for a given year and month from the specified FTP path to a local directory.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>YEAR</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>The year for which the files should be downloaded.</p>
              </div>
            </li>
            <li>
              <b><code>MONTH</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>The month or months for which the files should be downloaded.</p>
              </div>
            </li>
            <li>
              <b><code>ftp_path_to_files</code></b>
                  (<code>str</code>, default:
                      <code>&#39;ftp://ftp.ifremer.fr/ifremer/dataref/ww3/GLOBMULTI_ERA5_GLOBCUR_01/GLOB-30M/2020/FIELD_NC/&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The FTP path to the WW3 files.</p>
              </div>
            </li>
            <li>
              <b><code>ww3_local_path</code></b>
                  (<code>str</code>, default:
                      <code>&#39;../../data/ww3/&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The local directory where the files should be saved.</p>
              </div>
            </li>
            <li>
              <b><code>prefix</code></b>
                  (<code>str</code>, default:
                      <code>&#39;WW3-GLOB-30M&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>The prefix for the WW3 files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_body_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_ww3_local</span><span class="p">(</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">MONTH</span><span class="p">,</span> <span class="n">ftp_path_to_files</span><span class="o">=</span><span class="s2">&quot;ftp://ftp.ifremer.fr/ifremer/dataref/ww3/GLOBMULTI_ERA5_GLOBCUR_01/GLOB-30M/2020/FIELD_NC/&quot;</span><span class="p">,</span> <span class="n">ww3_local_path</span><span class="o">=</span> <span class="s1">&#39;../../data/ww3/&#39;</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;WW3-GLOB-30M&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download WW3 files for a given year and month from the specified FTP path to a local directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        YEAR (int): The year for which the files should be downloaded.</span>
<span class="sd">        MONTH (list): The month or months for which the files should be downloaded.</span>
<span class="sd">        ftp_path_to_files (str, optional): The FTP path to the WW3 files.</span>
<span class="sd">        ww3_local_path (str, optional): The local directory where the files should be saved.</span>
<span class="sd">        prefix (str, optional): The prefix for the WW3 files.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">workdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="c1"># create directory if it does not exist</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">)</span> 
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">)</span>

    <span class="c1"># download files</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading WW3 files for year </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">YEAR</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">MONTH</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading can take some time...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file_p2l</span> <span class="o">=</span> <span class="n">ftp_path_to_files</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%d%02d</span><span class="s2">_p2l.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="c1"># p2l file</span>
        <span class="n">check_file_p2l</span> <span class="o">=</span> <span class="n">ww3_local_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%d%02d</span><span class="s2">_p2l.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="c1"># p2l file</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">check_file_p2l</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">check_file_p2l</span> <span class="o">+</span> <span class="s2">&quot; already downloaded</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;wget -nv -c </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">file_p2l</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_p2l</span> <span class="o">+</span> <span class="s2">&quot; downloaded</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;WW3 files downloaded in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current directory : &quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_body_waves.loop_ww3_sources" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_ww3_sources</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dpt1</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">wave_type</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">date_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="n">c_file</span><span class="o">=</span><span class="s1">&#39;../../data/cP.nc&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;WW3-GLOB-30M&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Compute the equivalent vertical force on the seafloor for a given wave type (P or S), given a path to the ww3 p2l file, the bathymetry, the wave type, the date vector and the spatial extent.
Saves in netcdf format the equivalent vertical force for each frequency if save argument True.
    Plots in PNG source maps of P/S waves at given intervals depending on plot variables.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>paths</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>[file_bathy, ww3_local_path]: paths of additional files bathymetry, ww3 p2l file</p>
              </div>
            </li>
            <li>
              <b><code>dpt1</code></b>
                  (<code><span title="xarray.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>bathymetry grid in m (depth) with dimensions lon x lat</p>
              </div>
            </li>
            <li>
              <b><code>zlon</code></b>
                  (<code><span title="xarray.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>longitude of bathymetry file (°)</p>
              </div>
            </li>
            <li>
              <b><code>zlat</code></b>
                  (<code><span title="xarray.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>latitude of bathymetry file (°)</p>
              </div>
            </li>
            <li>
              <b><code>wave_type</code></b>
                  (<code>str</code>, default:
                      <code>&#39;P&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>P or S waves.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <pre><code>date_vect (list, optional): date vector [year, month, day, hour], with hour in [0, 3, 6, 9, 12, 15, 18, 21].
    extent (list, optional): spatial extent format [lon_min, lon_max, lat_min, lat_max].
    parameters (list, optional): parameters minimum frequency, maximum frequency.
c_file (str, optional): path to amplification coefficient file.
    prefix (str, optional) : prefix of ww3 p2l file.
        plot (Bool, optional): default: True
        plot_hourly (Bool, optional): plot maps every 3-hours default: False
        plot_daily (Bool, optional): plot maps every day, default: False
        plot_monthly (Bool, optional): plot maps every month, default : True
        plot_yearly (Bool, optional): plot map for the year average, default: False
        save (Bool, optional): save 3-hourly matrix, default: False
</code></pre>

            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_body_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">loop_ww3_sources</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dpt1</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">wave_type</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">date_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span><span class="n">parameters</span><span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">c_file</span> <span class="o">=</span> <span class="s2">&quot;../../data/cP.nc&quot;</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;WW3-GLOB-30M&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the equivalent vertical force on the seafloor for a given wave type (P or S), given a path to the ww3 p2l file, the bathymetry, the wave type, the date vector and the spatial extent.</span>
<span class="sd">    Saves in netcdf format the equivalent vertical force for each frequency if save argument True.</span>
<span class="sd">	Plots in PNG source maps of P/S waves at given intervals depending on plot variables.</span>

<span class="sd">    Args:</span>
<span class="sd">	    paths (list): [file_bathy, ww3_local_path]: paths of additional files bathymetry, ww3 p2l file</span>
<span class="sd">	    dpt1 (xarray.ndarray): bathymetry grid in m (depth) with dimensions lon x lat</span>
<span class="sd">	    zlon (xarray.ndarray): longitude of bathymetry file (°)</span>
<span class="sd">	    zlat (xarray.ndarray): latitude of bathymetry file (°)</span>
<span class="sd">	    wave_type (str, optional): P or S waves.</span>
<span class="sd">        date_vect (list, optional): date vector [year, month, day, hour], with hour in [0, 3, 6, 9, 12, 15, 18, 21].</span>
<span class="sd">	    extent (list, optional): spatial extent format [lon_min, lon_max, lat_min, lat_max].</span>
<span class="sd">	    parameters (list, optional): parameters minimum frequency, maximum frequency.</span>
<span class="sd">        c_file (str, optional): path to amplification coefficient file.</span>
<span class="sd">	    prefix (str, optional) : prefix of ww3 p2l file.</span>
<span class="sd">		plot (Bool, optional): default: True</span>
<span class="sd">		plot_hourly (Bool, optional): plot maps every 3-hours default: False</span>
<span class="sd">		plot_daily (Bool, optional): plot maps every day, default: False</span>
<span class="sd">		plot_monthly (Bool, optional): plot maps every month, default : True</span>
<span class="sd">		plot_yearly (Bool, optional): plot map for the year average, default: False</span>
<span class="sd">		save (Bool, optional): save 3-hourly matrix, default: False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_bathy</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ww3_local_path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Constants</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mf">6.371</span><span class="o">*</span><span class="mf">1e6</span> <span class="c1"># radius of the earth in meters</span>
    <span class="n">lg10</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># log of 10</span>
    <span class="c1">#</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">## Initialize variables</span>
    <span class="k">if</span> <span class="s1">&#39;plot_type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">plot_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plot_type&#39;</span><span class="p">]</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
            <span class="n">plot_hourly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_hourly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_hourly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="n">plot_daily</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_daily</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_daily</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
            <span class="n">plot_monthly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_monthly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_monthly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;yearly&#39;</span><span class="p">:</span>
            <span class="n">plot_yearly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_yearly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_yearly</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1e10</span>

    <span class="c1">## Adapt latitude and longitude to values in parameters file</span>
    <span class="n">lon_min</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lon_max</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lat_min</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">lat_max</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
    <span class="n">zlat</span> <span class="o">=</span> <span class="n">zlat</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>
    <span class="n">zlon</span> <span class="o">=</span> <span class="n">zlon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>

    <span class="c1">## Open Amplification Coefficient</span>
    <span class="c1"># check for refined bathymetry</span>
    <span class="n">res_bathy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">zlon</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zlon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">res_bathy</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">ds_ampli</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;../../data/c</span><span class="si">%s</span><span class="s1">.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wave_type</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">ds_ampli</span><span class="p">[</span><span class="s1">&#39;c</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">wave_type</span><span class="p">]</span>
        <span class="n">refined</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refined bathymetry grid </span><span class="se">\n</span><span class="s2"> PLEASE RUN amplification_coefficients.ipynb before running this script&quot;</span><span class="p">)</span>
        <span class="n">ds_ampli</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">c_file</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">ds_ampli</span><span class="p">[</span><span class="s1">&#39;c</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">wave_type</span><span class="p">]</span>        
        <span class="n">refined</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">## Surface Element</span>
    <span class="n">msin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">zlat</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlon</span><span class="p">)))</span>
    <span class="n">res_mod</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zlat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zlat</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">dA</span> <span class="o">=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">res_mod</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">msin</span><span class="p">,</span><span class="n">ones</span><span class="p">)</span>

    <span class="c1">## Loop over dates</span>
    <span class="n">YEAR</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">MONTH</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DAY</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">iyear</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">YEAR</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">MONTH</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MONTH</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">MONTH</span><span class="p">):</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">imonth</span> <span class="ow">in</span> <span class="n">MONTH</span><span class="p">:</span>
            <span class="n">TOTAL_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># Initiate monthly source of Rayleigh wave matrix</span>
            <span class="n">daymax</span> <span class="o">=</span> <span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span><span class="n">imonth</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">filename_p2l</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d%02d</span><span class="s1">_p2l.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File WW3 &quot;</span><span class="p">,</span> <span class="n">filename_p2l</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DAY</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">day</span><span class="o">==</span><span class="n">daymax</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">imonth</span> <span class="o">==</span> <span class="n">MONTH</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">[:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">imonth</span> <span class="o">==</span> <span class="n">MONTH</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">day</span><span class="o">==</span><span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">daymax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">day</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">day</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span><span class="n">imonth</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iday</span> <span class="ow">in</span> <span class="n">day</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">HOUR</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">HOUR</span><span class="p">])</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">HOUR</span><span class="p">):</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">HOUR</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ih</span> <span class="ow">in</span> <span class="n">HOUR</span><span class="p">:</span>

                    <span class="c1">## Open F_p3D </span>
                    <span class="p">(</span><span class="n">lati</span><span class="p">,</span> <span class="n">longi</span><span class="p">,</span> <span class="n">freq_ocean</span><span class="p">,</span> <span class="n">p2l</span><span class="p">,</span> <span class="n">unit1</span><span class="p">)</span> <span class="o">=</span> <span class="n">read_p2l</span><span class="p">(</span><span class="n">filename_p2l</span><span class="p">,</span> <span class="p">[</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">],</span> <span class="p">[</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">],</span> <span class="p">[</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">])</span>
                    <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_ocean</span><span class="p">)</span>  <span class="c1"># number of frequencies </span>
                    <span class="n">xfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">freq_ocean</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">freq_ocean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># determines the xfr geometric progression factor</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">freq_ocean</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xfr</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">xfr</span><span class="p">)</span>  <span class="c1"># frequency interval in wave model times 2</span>
                    <span class="n">freq_seismic</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_ocean</span>  <span class="c1"># ocean to seismic waves freq</span>
                    <span class="c1">## Check units of the model, depends on version</span>
                    <span class="k">if</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(Pa2 m2 s+1E-12&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span>  <span class="o">-</span> <span class="p">(</span><span class="mf">1e-12</span><span class="o">-</span><span class="mf">1e-16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(m4s+0.01&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.009999</span>
                    <span class="k">elif</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(Pa2 m2 s+1E-12)&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span>  <span class="o">-</span> <span class="p">(</span><span class="mf">1e-12</span><span class="o">-</span><span class="mf">1e-16</span><span class="p">)</span>

                    <span class="c1">## Integral over a frequency band</span>

                    <span class="k">if</span> <span class="n">f1</span> <span class="o">&lt;</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">index_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">f1</span> <span class="o">&lt;=</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="n">freq_seismic</span> <span class="o">&lt;=</span> <span class="n">f2</span><span class="p">)</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">freq_seismic</span> <span class="o">=</span> <span class="n">freq_seismic</span><span class="p">[</span><span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">n_freq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">p2l</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq_ocean</span><span class="p">[</span><span class="n">index_freq</span><span class="p">],</span> <span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">Fp</span><span class="p">))</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
                        <span class="n">Fp</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_seismic</span>
                        <span class="n">res_p2l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fp</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Fp</span><span class="o">.</span><span class="n">longitude</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">res_bathy</span> <span class="o">!=</span> <span class="n">res_p2l</span><span class="p">:</span>
                            <span class="c1"># interpolate Fp</span>
                            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">zlon</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">zlat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
                        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">amplification_coeff</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">amplification_coeff</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
                        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">amplification_coeff</span><span class="o">.</span><span class="n">reindex_like</span><span class="p">(</span><span class="n">Fp</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                        <span class="n">F_f</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">*</span><span class="n">amplification_coeff</span><span class="o">**</span><span class="mi">2</span>
                        <span class="n">F</span> <span class="o">=</span> <span class="n">F_f</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">ifq</span><span class="p">,</span> <span class="n">fq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq_seismic</span><span class="p">):</span>
                            <span class="n">F_f</span><span class="p">[</span><span class="n">ifq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">*=</span> <span class="n">dA</span>
                            <span class="n">F</span><span class="p">[</span><span class="n">ifq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">F_f</span><span class="p">[</span><span class="n">ifq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span><span class="o">*</span><span class="n">df</span><span class="p">[</span><span class="n">ifq</span><span class="p">]</span>
                        <span class="n">F</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span><span class="p">))</span>
                    <span class="c1">## Single frequency</span>
                    <span class="k">elif</span> <span class="n">f1</span> <span class="o">==</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">index_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">freq</span><span class="o">-</span><span class="n">f1</span><span class="p">)))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unique frequency &#39;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1">## Exception in parametrization of frequencies</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;two frequencies with f2 &lt; f1 were given&#39;</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1">## Save F to file</span>
                    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">path_out</span> <span class="o">=</span> <span class="s1">&#39;./F/&#39;</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_out</span><span class="p">):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;make directory </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">path_out</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>

                        <span class="c1"># Create netCDF 3-hourly file</span>
                        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_out</span><span class="o">+</span><span class="s2">&quot;F_</span><span class="si">%d%02d%02d%02d</span><span class="s2">.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4_CLASSIC&#39;</span><span class="p">)</span>
                        <span class="n">lat_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlat</span><span class="p">))</span>  <span class="c1"># latitude axis</span>
                        <span class="n">lon_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlon</span><span class="p">))</span>  <span class="c1"># longitude axis</span>
                        <span class="n">time_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">daymax</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># unlimited axis (can be appended to).</span>
                        <span class="n">freq_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">n_freq</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Equivalent Vertical Force on </span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;Equivalent Force every 3 hours for the secondary microseismic peak&#39;</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,))</span>
                        <span class="n">lat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_north&#39;</span>
                        <span class="n">lat</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,))</span>
                        <span class="n">lon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_east&#39;</span>
                        <span class="n">lon</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span>
                        <span class="n">time</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;hours since 1990-01-01&#39;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
                        <span class="n">freq_nc</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,))</span>
                        <span class="n">freq_nc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Hz&#39;</span>
                        <span class="n">freq_nc</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span>
                        <span class="n">F_freq</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;F_f&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">))</span>
                        <span class="n">F_freq</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;N.s^{1/2}&#39;</span>
                        <span class="n">F_freq</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Equivalent Vertical Force spectrum&#39;</span>
                        <span class="n">lat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zlat</span>
                        <span class="n">lon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zlon</span>
                        <span class="n">freq_nc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">freq_seismic</span>
                        <span class="n">F_freq</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">F_f</span>
                        <span class="n">time</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;hours since 1990-01-01&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                    <span class="c1">## Plot F</span>
                    <span class="k">if</span> <span class="n">plot_hourly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> 
                        <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> 
                                                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                                <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                                                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
                        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
                        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                        <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                        <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">wave_type</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                            <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d%02d%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wave_type</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

                    <span class="c1">## Sum F</span>
                    <span class="k">if</span> <span class="n">plot_daily</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">F_daily</span> <span class="o">+=</span> <span class="n">F</span>
                    <span class="k">if</span> <span class="n">plot_monthly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">F_monthly</span> <span class="o">+=</span> <span class="n">F</span>
                    <span class="k">if</span> <span class="n">plot_yearly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">F_yearly</span> <span class="o">+=</span> <span class="n">F</span>

                <span class="k">if</span> <span class="n">plot_daily</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> 
                    <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F_daily</span><span class="p">,</span> 
                        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">.</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">wave_type</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                        <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d%02d%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wave_type</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                    <span class="n">F_daily</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">plot_monthly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F_monthly</span><span class="p">,</span> 
                    <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                    <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wave_type</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                    <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wave_type</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">F_monthly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">plot_yearly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F_yearly</span><span class="p">,</span>
                                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">wave_type</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">wave_type</span> <span class="o">==</span> <span class="s1">&#39;P&#39;</span><span class="p">:</span>
                <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">wave_type</span><span class="p">,</span> <span class="n">iyear</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">F_daily</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">F_yearly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> source maps done!&#39;</span><span class="o">%</span><span class="n">wave_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_body_waves.open_bathy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_bathy</span><span class="p">(</span><span class="n">file_bathy</span><span class="o">=</span><span class="s1">&#39;../../data/WW3-GLOB-30M_202002_p2l.nc&#39;</span><span class="p">,</span> <span class="n">refined_bathymetry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Open bathymetry file and optionally refine bathymetry using ETOPOv2 dataset. </p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_bathy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;../../data/WW3-GLOB-30M_202002_p2l.nc&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Path to the bathymetry file.</p>
              </div>
            </li>
            <li>
              <b><code>refined_bathymetry</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether to use the refined ETOPOv2 dataset. Defaults to False.</p>
              </div>
            </li>
            <li>
              <b><code>extent</code></b>
                  (<code>list</code>, default:
                      <code>[-180, 180, -90, 90]</code>
)
              –
              <div class="doc-md-description">
                <p>The geographical extent of the bathymetry data in the format [lon_min, lon_max, lat_min, lat_max].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dpt1_mask</code></b>(                  <code><span title="xarray.DataArray">DataArray</span></code>
)              –
              <div class="doc-md-description">
                <p>Masked bathymetry data.</p>
              </div>
            </li>
            <li>
<b><code>zlon</code></b>(                  <code><span title="xarray.DataArray">DataArray</span></code>
)              –
              <div class="doc-md-description">
                <p>Longitude coordinates.</p>
              </div>
            </li>
            <li>
<b><code>zlat</code></b>(                  <code><span title="xarray.DataArray">DataArray</span></code>
)              –
              <div class="doc-md-description">
                <p>Latitude coordinates.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_body_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open_bathy</span><span class="p">(</span><span class="n">file_bathy</span> <span class="o">=</span> <span class="s1">&#39;../../data/WW3-GLOB-30M_202002_p2l.nc&#39;</span><span class="p">,</span> <span class="n">refined_bathymetry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open bathymetry file and optionally refine bathymetry using ETOPOv2 dataset. </span>

<span class="sd">    Args:</span>
<span class="sd">        file_bathy (str): Path to the bathymetry file.</span>
<span class="sd">        refined_bathymetry (bool, optional): Whether to use the refined ETOPOv2 dataset. Defaults to False.</span>
<span class="sd">        extent (list, optional): The geographical extent of the bathymetry data in the format [lon_min, lon_max, lat_min, lat_max].</span>

<span class="sd">    Returns:</span>
<span class="sd">        dpt1_mask (xarray.DataArray): Masked bathymetry data.</span>
<span class="sd">        zlon (xarray.DataArray): Longitude coordinates.</span>
<span class="sd">        zlat (xarray.DataArray): Latitude coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">[</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">extent</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">file_bathy</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">refined_bathymetry</span> <span class="ow">or</span> <span class="n">file_bathy</span> <span class="o">==</span> <span class="s1">&#39;../../data/ETOPO_2022_v1_60s_N90W180_bed.nc&#39;</span><span class="p">:</span>
        <span class="c1"># load refined bathymetry ETOPOv2</span>
        <span class="n">file_bathy</span> <span class="o">=</span> <span class="s1">&#39;../../data/ETOPO_2022_v1_60s_N90W180_bed.nc&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">file_bathy</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
            <span class="n">ds</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">})</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># ETOPOv2 to Depth</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">dpt1</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>         
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refined bathymetry ETOPOv2 not found. </span><span class="se">\n</span><span class="s2">You can download it from:</span><span class="se">\n</span><span class="s2"> https://www.ngdc.noaa.gov/thredds/catalog/global/ETOPO2022/60s/60s_bed_elev_netcdf/catalog.html?dataset=globalDatasetScan/ETOPO2022/60s/60s_bed_elev_netcdf/ETOPO_2022_v1_60s_N90W180_bed.nc</span><span class="se">\n</span><span class="s2">Save in ../data/&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="c1">## Mask nan values    </span>
    <span class="n">dpt1_mask</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dpt1</span><span class="p">))</span>
    <span class="n">zlon</span> <span class="o">=</span> <span class="n">dpt1_mask</span><span class="o">.</span><span class="n">longitude</span>
    <span class="n">zlat</span> <span class="o">=</span> <span class="n">dpt1_mask</span><span class="o">.</span><span class="n">latitude</span>
    <span class="k">return</span> <span class="n">dpt1_mask</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_body_waves.subfcn_liquid_solid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">subfcn_liquid_solid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">mt</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Calculate the reflection and transmission coefficients for P and S waves between two media.
Author: LI Lei, ll.ynyf@gmail.com modified by Pierre Boue 23/11/2020</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>p</code></b>
                  (<code>float or array - like</code>)
              –
              <div class="doc-md-description">
                <p>The wave slowness.</p>
              </div>
            </li>
            <li>
              <b><code>mi</code></b>
                  (<code>tuple</code>)
              –
              <div class="doc-md-description">
                <p>The properties of the incident medium, consisting of the vertical P-wave velocity (vp1) and density (rho1).</p>
              </div>
            </li>
            <li>
              <b><code>mt</code></b>
                  (<code>tuple</code>)
              –
              <div class="doc-md-description">
                <p>The properties of the transmitted medium, consisting of the vertical P-wave velocity (vp2), shear wave velocity (vs2), and density (rho2).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>Rpp</code></b>(                  <code>float or array - like</code>
)              –
              <div class="doc-md-description">
                <p>The reflection coefficient for P waves.</p>
              </div>
            </li>
            <li>
<b><code>Tpp</code></b>(                  <code>float or array - like</code>
)              –
              <div class="doc-md-description">
                <p>The transmission coefficient for P waves.</p>
              </div>
            </li>
            <li>
<b><code>Tps</code></b>(                  <code>float or array - like</code>
)              –
              <div class="doc-md-description">
                <p>The transmission coefficient for S waves.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_body_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">subfcn_liquid_solid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="n">mt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the reflection and transmission coefficients for P and S waves between two media.</span>
<span class="sd">    Author: LI Lei, ll.ynyf@gmail.com modified by Pierre Boue 23/11/2020</span>

<span class="sd">    Args:</span>
<span class="sd">        p (float or array-like): The wave slowness.</span>
<span class="sd">        mi (tuple): The properties of the incident medium, consisting of the vertical P-wave velocity (vp1) and density (rho1).</span>
<span class="sd">        mt (tuple): The properties of the transmitted medium, consisting of the vertical P-wave velocity (vp2), shear wave velocity (vs2), and density (rho2).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Rpp (float or array-like): The reflection coefficient for P waves.</span>
<span class="sd">        Tpp (float or array-like): The transmission coefficient for P waves.</span>
<span class="sd">        Tps (float or array-like): The transmission coefficient for S waves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="c1"># vp, density of incident medium, vp, vs, density of transmitted medium</span>
    <span class="p">(</span><span class="n">vp1</span><span class="p">,</span> <span class="n">rho1</span><span class="p">,</span> <span class="n">vp2</span><span class="p">,</span> <span class="n">vs2</span><span class="p">,</span> <span class="n">rho2</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">mi</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mt</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">csqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vp1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span>  <span class="c1"># vertical slowness</span>
    <span class="n">q2p</span> <span class="o">=</span> <span class="n">csqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vp2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">q2s</span> <span class="o">=</span> <span class="n">csqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">vs2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span>

    <span class="n">a</span> <span class="o">=</span> <span class="n">rho2</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">p2</span><span class="o">*</span><span class="n">vs2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">vs2</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">p2</span><span class="o">*</span><span class="n">q2p</span><span class="o">*</span><span class="n">q2s</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">rho1</span><span class="o">*</span><span class="n">q2p</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
    <span class="n">Rpp</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">D</span>
    <span class="n">Tpp</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">rho1</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">vs2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="n">Tps</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">rho1</span><span class="o">*</span><span class="n">q1</span><span class="o">*</span><span class="n">q2p</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">vs2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">reciprocal</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Rpp</span><span class="p">,</span> <span class="n">Tpp</span><span class="p">,</span> <span class="n">Tps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../read_hs_p2l/" class="btn btn-neutral float-left" title="Read WW3 Files"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../rayleigh_waves/" class="btn btn-neutral float-right" title="Rayleigh Wave">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://gricad-gitlab.univ-grenoble-alpes.fr/tomasetl/ww3-source-maps" class="icon icon-gitlab" style="color: #fcfcfc"> GitLab</a>
        </span>
    
    
      <span><a href="../read_hs_p2l/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../rayleigh_waves/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
