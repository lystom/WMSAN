<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Rayleigh Waves - WMSAN</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Rayleigh Waves";
        var mkdocs_page_input_path = "api_overview/rayleigh_waves.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../img/logowmsan.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../getting_started/">Getting Started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">API Overview</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../api_overview/">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../read_hs_p2l/">Read WW3 Files</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../body_waves/">Body Waves</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Rayleigh Waves</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../temporal_variations/">Temporal Variations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../synthetics/">Synthetic Cross-Correlation Functions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../wmsan_to_noisi/">To noisi</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../user_guide/">Tutorials</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Site Effect</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/amplification_coeff/">Rayleigh Waves Site Effect</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/body_waves/amplification_coeff/">Body Waves Site Effect</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Equivalent Vertical Force Maps</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/microseismic_sources/">Rayleigh Waves Equivalent Vertical Force</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/body_waves/microseismic_sources/">Body Waves Equivalent Vertical Force</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../notebooks/rayleigh_waves/temporal_variations/">Rayleigh Waves Temporal Variations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Synthetic Cross-Correlation Functions</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/synthetic_CCF/">Rayleigh Waves Synthetic Cross-correlation Functions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/body_waves/synthetic_CCF/">Body Waves Synthetics Cross-correlation Functions</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../notebooks/rayleigh_waves/wmsan_to_noisi/">WMSAN to noisi</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Synthetic Spectrograms</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/rayleigh_source/">Rayleigh Waves Power Spectrum of Vertical Displacement</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../notebooks/rayleigh_waves/spectrograms/">Rayleigh Waves Synthetic Spectrograms</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developer_guide/">How to contribute ?</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../about/">About</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">WMSAN</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Overview</li>
      <li class="breadcrumb-item active">Rayleigh Waves</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="rayleigh-waves">Rayleigh Waves</h2>


<div class="doc doc-object doc-module">



<a id="wmsan.subfunctions_rayleigh_waves"></a>
    <div class="doc doc-contents first">

      <p>This set of functions aims at modeling the ambient noise source in the secondary microseismic range for Rayleigh waves.
Using Longuet-Higgins site effect and WW3 model.</p>
<p>It contains six functions:</p>
<ul>
<li>
<p><code>site_effect(z, f, zlat, zlon, vs_crust, path)</code>: compute the site effect based on Longuet-Higgins tables.</p>
</li>
<li>
<p><code>download_ww3_local(YEAR, MONTH, ftp_path_to_files, ww3_local_path, prefix)</code>: download the WW3 files for the given month.</p>
</li>
<li>
<p><code>open_bathy(file_bathy, refined_bathymetry, extent)</code>: open the bathymetry file. Either default WW3 grid, ETOPOv2 or a custom grid.</p>
</li>
<li>
<p><code>loop_SDF(paths, dpt1, zlon, zlat, date_vec, extent, parameters, prefix, **kwargs)</code>: Computes the power spectrum of the vertical displacement for Rayleigh waves in m.s.</p>
</li>
<li>
<p><code>spectrogram(path_netcdf, dates, lon_sta, lat_sta, Q, U, P, **kwargs)</code>: Plot spectrogram for a given path to NetCDF file, dates, and optional station coordinates and constants.</p>
</li>
<li>
<p><code>loop_ww3_sources(paths, dpt1, zlon, zlat, wave_type, date_vec, extent, parameters, c_file, prefix, **kwargs)</code>: compute the equivalent vertical force.</p>
</li>
</ul>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_rayleigh_waves.download_ww3_local" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">download_ww3_local</span><span class="p">(</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">MONTH</span><span class="p">,</span> <span class="n">ftp_path_to_files</span><span class="o">=</span><span class="s1">&#39;ftp://ftp.ifremer.fr/ifremer/dataref/ww3/GLOBMULTI_ERA5_GLOBCUR_01/GLOB-30M/2020/FIELD_NC/&#39;</span><span class="p">,</span> <span class="n">ww3_local_path</span><span class="o">=</span><span class="s1">&#39;../../data/ww3/&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;WW3-GLOB-30M&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Download WW3 files for a given year and month from the specified FTP path to a local directory.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>YEAR</code></b>
                  (<code>int</code>)
              –
              <div class="doc-md-description">
                <p>the year for which the files should be downloaded.</p>
              </div>
            </li>
            <li>
              <b><code>MONTH</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>the month or months for which the files should be downloaded.</p>
              </div>
            </li>
            <li>
              <b><code>ftp_path_to_files</code></b>
                  (<code>str</code>, default:
                      <code>&#39;ftp://ftp.ifremer.fr/ifremer/dataref/ww3/GLOBMULTI_ERA5_GLOBCUR_01/GLOB-30M/2020/FIELD_NC/&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the FTP path to the WW3 files.</p>
              </div>
            </li>
            <li>
              <b><code>ww3_local_path</code></b>
                  (<code>str</code>, default:
                      <code>&#39;../../data/ww3/&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the local directory where the files should be saved.</p>
              </div>
            </li>
            <li>
              <b><code>prefix</code></b>
                  (<code>str</code>, default:
                      <code>&#39;WW3-GLOB-30M&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the prefix for the WW3 files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_rayleigh_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">download_ww3_local</span><span class="p">(</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">MONTH</span><span class="p">,</span> <span class="n">ftp_path_to_files</span><span class="o">=</span><span class="s2">&quot;ftp://ftp.ifremer.fr/ifremer/dataref/ww3/GLOBMULTI_ERA5_GLOBCUR_01/GLOB-30M/2020/FIELD_NC/&quot;</span><span class="p">,</span> <span class="n">ww3_local_path</span><span class="o">=</span> <span class="s1">&#39;../../data/ww3/&#39;</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;WW3-GLOB-30M&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Download WW3 files for a given year and month from the specified FTP path to a local directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        YEAR (int): the year for which the files should be downloaded.</span>
<span class="sd">        MONTH (list): the month or months for which the files should be downloaded.</span>
<span class="sd">        ftp_path_to_files (str): the FTP path to the WW3 files.</span>
<span class="sd">        ww3_local_path (str): the local directory where the files should be saved.</span>
<span class="sd">        prefix (str): the prefix for the WW3 files.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">workdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="c1"># create directory if it does not exist</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">)</span> 
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span> 
        <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">)</span>

    <span class="c1"># download files</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading WW3 files for year </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">YEAR</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">MONTH</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading can take some time...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">file_p2l</span> <span class="o">=</span> <span class="n">ftp_path_to_files</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%d%02d</span><span class="s2">_p2l.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="c1"># p2l file</span>
        <span class="n">check_file_p2l</span> <span class="o">=</span> <span class="n">ww3_local_path</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%d%02d</span><span class="s2">_p2l.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="c1"># p2l file</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">check_file_p2l</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">check_file_p2l</span> <span class="o">+</span> <span class="s2">&quot; already downloaded</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;wget -nv -c </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">file_p2l</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">file_p2l</span> <span class="o">+</span> <span class="s2">&quot; downloaded</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span> <span class="s2">&quot;WW3 files downloaded in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">))</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current directory : &quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_rayleigh_waves.loop_SDF" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_SDF</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dpt1</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">date_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">2830</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;WW3-GLOB-30M&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Computes the power spectrum of the vertical displacement for Rayleigh waves in m.s.
Saves in netcdf format if save argument True.
Plots in PNG source maps of Rayleigh waves at given intervals depending on plot variables.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>paths</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>[file_bathy, ww3_local_path, longuet_higgins_file]: paths of additional files bathymetry, ww3 p2l file and Longuet-Higgins coefficients</p>
              </div>
            </li>
            <li>
              <b><code>dpt1</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>bathymetry grid in m (depth) with dimensions lon x lat</p>
              </div>
            </li>
            <li>
              <b><code>zlon</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>longitude of bathymetry file (°)</p>
              </div>
            </li>
            <li>
              <b><code>zlat</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>latitude of bathymetry file (°)</p>
              </div>
            </li>
            <li>
              <b><code>date_vec</code></b>
                  (<code>list</code>, default:
                      <code>[2020, [], [], []]</code>
)
              –
              <div class="doc-md-description">
                <p>date vector [year, month, day, hour], with hour in [0, 3, 6, 9, 12, 15, 18, 21].</p>
              </div>
            </li>
            <li>
              <b><code>extent</code></b>
                  (<code>list</code>, default:
                      <code>[-180, 180, -90, 90]</code>
)
              –
              <div class="doc-md-description">
                <p>spatial extent format [lon_min, lon_max, lat_min, lat_max].</p>
              </div>
            </li>
            <li>
              <b><code>parameters</code></b>
                  (<code>list</code>, default:
                      <code>[2.8, 2830, 1 / 12, 0.2]</code>
)
              –
              <div class="doc-md-description">
                <p>parameters vS of the crust, density of the crust, minimum frequency, maximum frequency.</p>
              </div>
            </li>
            <li>
              <b><code>prefix</code></b>
                  (<code>str</code>, default:
                      <code>&#39;WW3-GLOB-30M&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>prefix of the ww3 p2l file.</p>
              </div>
            </li>
            <li>
              <b><code>plot</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps.</p>
              </div>
            </li>
            <li>
              <b><code>plot_hourly</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps every 3-hours default = False.</p>
              </div>
            </li>
            <li>
              <b><code>plot_daily</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps every day, default = False.</p>
              </div>
            </li>
            <li>
              <b><code>plot_monthly</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps every month, default = True.</p>
              </div>
            </li>
            <li>
              <b><code>plot_yearly</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot map for the year average, default = False.</p>
              </div>
            </li>
            <li>
              <b><code>save</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>save 3-hourly matrix, default = False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_rayleigh_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">loop_SDF</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dpt1</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">date_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span><span class="n">parameters</span><span class="o">=</span> <span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="mi">2830</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;WW3-GLOB-30M&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Computes the power spectrum of the vertical displacement for Rayleigh waves in m.s.</span>
<span class="sd">    Saves in netcdf format if save argument True.</span>
<span class="sd">    Plots in PNG source maps of Rayleigh waves at given intervals depending on plot variables.</span>

<span class="sd">    Args:</span>
<span class="sd">        paths (list): [file_bathy, ww3_local_path, longuet_higgins_file]: paths of additional files bathymetry, ww3 p2l file and Longuet-Higgins coefficients</span>
<span class="sd">        dpt1 (xarray.DataArray): bathymetry grid in m (depth) with dimensions lon x lat</span>
<span class="sd">        zlon (xarray.DataArray): longitude of bathymetry file (°)</span>
<span class="sd">        zlat (xarray.DataArray): latitude of bathymetry file (°)</span>
<span class="sd">        date_vec (list): date vector [year, month, day, hour], with hour in [0, 3, 6, 9, 12, 15, 18, 21].</span>
<span class="sd">        extent (list, optional): spatial extent format [lon_min, lon_max, lat_min, lat_max].</span>
<span class="sd">        parameters (list, optional): parameters vS of the crust, density of the crust, minimum frequency, maximum frequency.</span>
<span class="sd">        prefix (str, optional): prefix of the ww3 p2l file.</span>
<span class="sd">        plot (bool, optional): plot maps.</span>
<span class="sd">        plot_hourly (bool, optional):  plot maps every 3-hours default = False.</span>
<span class="sd">        plot_daily (bool, optional): plot maps every day, default = False.</span>
<span class="sd">        plot_monthly (bool, optional): plot maps every month, default = True.</span>
<span class="sd">        plot_yearly (bool, optional): plot map for the year average, default = False.</span>
<span class="sd">        save (bool, optional): save 3-hourly matrix, default = False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_bathy</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ww3_local_path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">path_longuet_higgins</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Constants</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mf">6.371</span><span class="o">*</span><span class="mf">1e6</span> <span class="c1"># radius of the earth in meters</span>
    <span class="n">lg10</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># log of 10</span>
    <span class="n">vs_crust</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rho_s</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="c1">## Initialize variables</span>
    <span class="k">if</span> <span class="s1">&#39;plot_type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">plot_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plot_type&#39;</span><span class="p">]</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
            <span class="n">plot_hourly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">SDF_hourly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_hourly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="n">plot_daily</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">SDF_daily</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_daily</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
            <span class="n">plot_monthly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">SDF_monthly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_monthly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;yearly&#39;</span><span class="p">:</span>
            <span class="n">plot_yearly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">SDF_yearly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_yearly</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1e-16</span>

    <span class="c1">## Adapt latitude and longitude to values in parameters file</span>
    <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
    <span class="n">zlat</span> <span class="o">=</span> <span class="n">zlat</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>
    <span class="n">zlon</span> <span class="o">=</span> <span class="n">zlon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>

    <span class="c1">## Loop over dates</span>
    <span class="n">YEAR</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">MONTH</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DAY</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">iyear</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">YEAR</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">MONTH</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MONTH</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">MONTH</span><span class="p">):</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">imonth</span> <span class="ow">in</span> <span class="n">MONTH</span><span class="p">:</span>
            <span class="n">TOTAL_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># Initiate monthly source of Rayleigh wave matrix</span>
            <span class="n">daymax</span> <span class="o">=</span> <span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span><span class="n">imonth</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">filename_p2l</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d%02d</span><span class="s1">_p2l.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File WW3 &quot;</span><span class="p">,</span> <span class="n">filename_p2l</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DAY</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">day</span><span class="o">==</span><span class="n">daymax</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">imonth</span> <span class="o">==</span> <span class="n">MONTH</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">[:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">imonth</span> <span class="o">==</span> <span class="n">MONTH</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">day</span><span class="o">==</span><span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">daymax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">day</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">day</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span><span class="n">imonth</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iday</span> <span class="ow">in</span> <span class="n">day</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">HOUR</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">HOUR</span><span class="p">])</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">HOUR</span><span class="p">):</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">HOUR</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ih</span> <span class="ow">in</span> <span class="n">HOUR</span><span class="p">:</span>

                    <span class="c1">## Open F_p3D </span>
                    <span class="p">(</span><span class="n">lati</span><span class="p">,</span> <span class="n">longi</span><span class="p">,</span> <span class="n">freq_ocean</span><span class="p">,</span> <span class="n">p2l</span><span class="p">,</span> <span class="n">unit1</span><span class="p">)</span> <span class="o">=</span> <span class="n">read_p2l</span><span class="p">(</span><span class="n">filename_p2l</span><span class="p">,</span> <span class="p">[</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">],</span> <span class="p">[</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">],</span> <span class="p">[</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">])</span>
                    <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_ocean</span><span class="p">)</span>  <span class="c1"># number of frequencies </span>
                    <span class="n">xfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">freq_ocean</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">freq_ocean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># determines the xfr geometric progression factor</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">freq_ocean</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xfr</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">xfr</span><span class="p">)</span>  <span class="c1"># frequency interval in wave model times 2</span>
                    <span class="n">freq_seismic</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_ocean</span>  <span class="c1"># ocean to seismic waves freq</span>

                    <span class="c1">## Check units of the model, depends on version</span>
                    <span class="k">if</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(Pa2 m2 s+1E-12&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span>  <span class="o">-</span> <span class="p">(</span><span class="mf">1e-12</span><span class="o">-</span><span class="mf">1e-16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(m4s+0.01&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.009999</span>
                    <span class="k">elif</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(Pa2 m2 s+1E-12)&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span>  <span class="o">-</span> <span class="p">(</span><span class="mf">1e-12</span><span class="o">-</span><span class="mf">1e-16</span><span class="p">)</span>

                    <span class="c1">## Integral over a frequency band</span>
                    <span class="k">if</span> <span class="n">f1</span> <span class="o">&lt;</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">index_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">f1</span> <span class="o">&lt;=</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="n">freq_seismic</span> <span class="o">&lt;=</span> <span class="n">f2</span><span class="p">)</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">freq_seismic</span> <span class="o">=</span> <span class="n">freq_seismic</span><span class="p">[</span><span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">n_freq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">p2l</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq_ocean</span><span class="p">[</span><span class="n">index_freq</span><span class="p">],</span> <span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
                        <span class="n">C</span> <span class="o">=</span> <span class="n">site_effect</span><span class="p">(</span><span class="n">dpt1</span><span class="p">,</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span><span class="n">vs_crust</span><span class="p">,</span> <span class="n">path_longuet_higgins</span><span class="p">)</span>  <span class="c1"># computes Longuet-Higgins site effect given the bathymetryint(Fp.shape)</span>
                        <span class="k">if</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">Fp</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                            <span class="n">SDF_f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">rho_s</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">vs_crust</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">data</span><span class="o">*</span><span class="n">Fp</span><span class="o">.</span><span class="n">data</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">longitude</span> <span class="o">=</span> <span class="n">zlon</span><span class="p">)</span>
                            <span class="n">SDF_f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="n">rho_s</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">vs_crust</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">data</span><span class="o">*</span><span class="n">Fp</span><span class="o">.</span><span class="n">data</span>
                        <span class="k">if</span> <span class="n">SDF_f</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SDF shape&#39;</span><span class="p">,</span> <span class="n">SDF_f</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                            <span class="k">return</span>

                        <span class="c1">## Loop over frequencies of interest</span>
                        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_freq</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dpt1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dpt1</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq_seismic</span><span class="p">):</span>
                            <span class="n">SDF_f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fq</span><span class="o">.</span><span class="n">data</span><span class="o">*</span><span class="n">SDF_f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                            <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">SDF_f</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                        <span class="n">M</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
                        <span class="n">SDF</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">skipna</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

                    <span class="c1">## Single frequency</span>
                    <span class="k">elif</span> <span class="n">f1</span> <span class="o">==</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">index_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">freq</span><span class="o">-</span><span class="n">f1</span><span class="p">)))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unique frequency &#39;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">p2l</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">C</span> <span class="o">=</span> <span class="n">site_effect</span><span class="p">(</span><span class="n">dpt1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">vs_crust</span><span class="p">,</span> <span class="n">path_longuet_higgins</span><span class="p">)</span>
                        <span class="n">SDF_f</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f1</span><span class="o">/</span><span class="p">(</span><span class="n">rho_s</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">vs_crust</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">Fp</span><span class="o">.</span><span class="n">data</span><span class="o">*</span><span class="n">C</span><span class="o">.</span><span class="n">data</span>
                        <span class="n">SDF</span> <span class="o">=</span> <span class="n">SDF_f</span>

                    <span class="c1">## Exception in parametrization of frequencies</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;two frequencies with f2 &lt; f1 were given&#39;</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1">## Save SDF to file</span>
                    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="c1">## Save SDF to file</span>
                        <span class="n">path_out</span> <span class="o">=</span> <span class="s1">&#39;./SDF/&#39;</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_out</span><span class="p">):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;make directory &#39;</span><span class="o">+</span><span class="n">path_out</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>  
                        <span class="c1"># Create netCDF 3-hourly file</span>
                        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_out</span><span class="o">+</span><span class="s2">&quot;rayleigh_SDF_</span><span class="si">%d%02d%02d%02d</span><span class="s2">.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4_CLASSIC&#39;</span><span class="p">)</span>
                        <span class="n">lat_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlat</span><span class="p">))</span>  <span class="c1"># latitude axis</span>
                        <span class="n">lon_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlon</span><span class="p">))</span>  <span class="c1"># longitude axis</span>
                        <span class="n">time_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">daymax</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># unlimited axis (can be appended to).</span>
                        <span class="n">freq_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">n_freq</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rayleigh waves power spectrum of vertical displacement on </span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;Equivalent Force maps every 3 hours for the secondary microseismic peak&#39;</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,))</span>
                        <span class="n">lat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_north&#39;</span>
                        <span class="n">lat</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,))</span>
                        <span class="n">lon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_east&#39;</span>
                        <span class="n">lon</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span>
                        <span class="n">time</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;hours since 1990-01-01&#39;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
                        <span class="n">freq_nc</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,))</span>
                        <span class="n">freq_nc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Hz&#39;</span>
                        <span class="n">freq_nc</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span>
                        <span class="n">sdf_f</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;sdf_f&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">))</span>
                        <span class="n">sdf_f</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;m.s&#39;</span>
                        <span class="n">sdf_f</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Power spectrum of vertical displacement&#39;</span>
                        <span class="n">lat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zlat</span>
                        <span class="n">lon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zlon</span>
                        <span class="n">freq_nc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">freq_seismic</span>
                        <span class="n">sdf_f</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">SDF_f</span>
                        <span class="n">time</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;hours since 1990-01-01&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                    <span class="c1">## Plot SDF</span>
                    <span class="k">if</span> <span class="n">plot_hourly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> 
                        <span class="n">SDF_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">SDF</span><span class="p">,</span> 
                                                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                                <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                                                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Source of the power spectrum for the vertical displacement.</span><span class="se">\n</span><span class="s1">Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">))</span>
                        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Source of the power spectrum for the vertical displacement. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz. </span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">))</span>
                        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                        <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                        <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                        <span class="n">SDF_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;SDF (m)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">})</span> 
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;rayleigh_SDF_</span><span class="si">%d%02d%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

                    <span class="c1">## Sum SDF</span>
                    <span class="k">if</span> <span class="n">plot_daily</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">SDF_daily</span> <span class="o">+=</span> <span class="n">SDF</span>
                    <span class="k">if</span> <span class="n">plot_monthly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">SDF_monthly</span> <span class="o">+=</span> <span class="n">SDF</span>
                    <span class="k">if</span> <span class="n">plot_yearly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">SDF_yearly</span> <span class="o">+=</span> <span class="n">SDF</span>

                <span class="k">if</span> <span class="n">plot_daily</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="n">SDF_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">SDF_daily</span><span class="p">,</span>
                                            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Source of the power spectrum for the vertical displacement. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz </span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">))</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                    <span class="n">SDF_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;SDF (m)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">})</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;rayleigh_SDF_daily_</span><span class="si">%d%02d%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="n">SDF_daily</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">plot_monthly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="n">SDF_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">SDF_monthly</span><span class="p">,</span>
                                            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Source of the power spectrum for the vertical displacement. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz </span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">))</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                    <span class="n">SDF_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;SDF (m)&#39;</span><span class="p">,</span><span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">})</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;rayleigh_SDF_monthly_</span><span class="si">%d%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                    <span class="c1">#plt.show()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="n">SDF_monthly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">plot_yearly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="n">SDF_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">SDF_yearly</span><span class="p">,</span>
                                            <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                            <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Source of the power spectrum for the vertical displacement.Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">))</span>
                    <span class="n">SDF_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">vmin</span> <span class="o">=</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;SDF (m)&#39;</span><span class="p">,</span><span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">})</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;rayleigh_SDF_yearly_</span><span class="si">%d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                    <span class="n">SDF_yearly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Rayleigh source maps done!&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_rayleigh_waves.loop_ww3_sources" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loop_ww3_sources</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dpt1</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">date_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span> <span class="n">c_file</span><span class="o">=</span><span class="s1">&#39;../../data/C.nc&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;WW3-GLOB-30M&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Compute Rayleigh waves sources from ww3 p2l file as the equivalent vertical force on the seafloor.
Saves in netcdf format the equivalent vertical force for each frequency if save argument is True.
Plots in PNG source maps of P or S waves at given intervals depending on plot variables.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>paths</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>[file_bathy, ww3_local_path]: paths of additional files bathymetry, ww3 p2l file</p>
              </div>
            </li>
            <li>
              <b><code>dpt1</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>bathymetry grid in m (depth) with dimensions lon x lat</p>
              </div>
            </li>
            <li>
              <b><code>zlon</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>longitude of bathymetry file (°)</p>
              </div>
            </li>
            <li>
              <b><code>zlat</code></b>
                  (<code><span title="xarray.DataArray">DataArray</span></code>)
              –
              <div class="doc-md-description">
                <p>latitude of bathymetry file (°)</p>
              </div>
            </li>
            <li>
              <b><code>date_vec</code></b>
                  (<code>list</code>, default:
                      <code>[2020, [], [], []]</code>
)
              –
              <div class="doc-md-description">
                <p>date vector [year, month, day, hour], with hour in [0, 3, 6, 9, 12, 15, 18, 21]</p>
              </div>
            </li>
            <li>
              <b><code>extent</code></b>
                  (<code>list</code>, default:
                      <code>[-180, 180, -90, 90]</code>
)
              –
              <div class="doc-md-description">
                <p>spatial extent format [lon_min, lon_max, lat_min, lat_max].</p>
              </div>
            </li>
            <li>
              <b><code>parameters</code></b>
                  (<code>list</code>, default:
                      <code>[1 / 12, 1 / 2]</code>
)
              –
              <div class="doc-md-description">
                <p>parameters minimum frequency, maximum frequency.</p>
              </div>
            </li>
            <li>
              <b><code>c_file</code></b>
                  (<code>str</code>, default:
                      <code>&#39;../../data/C.nc&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>path to amplification coefficient file.</p>
              </div>
            </li>
            <li>
              <b><code>prefix</code></b>
                  (<code>str</code>, default:
                      <code>&#39;WW3-GLOB-30M&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>prefix of the ww3 p2l file.</p>
              </div>
            </li>
            <li>
              <b><code>plot</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps.</p>
              </div>
            </li>
            <li>
              <b><code>plot_hourly</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps every 3-hours.</p>
              </div>
            </li>
            <li>
              <b><code>plot_daily</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps every day.</p>
              </div>
            </li>
            <li>
              <b><code>plot_monthly</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot maps every month.</p>
              </div>
            </li>
            <li>
              <b><code>plot_yearly</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>plot map for the year average.</p>
              </div>
            </li>
            <li>
              <b><code>save</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>save 3-hourly matrix.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_rayleigh_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">loop_ww3_sources</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dpt1</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">date_vec</span><span class="o">=</span><span class="p">[</span><span class="mi">2020</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]],</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span><span class="n">parameters</span><span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">c_file</span> <span class="o">=</span> <span class="s1">&#39;../../data/C.nc&#39;</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;WW3-GLOB-30M&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Compute Rayleigh waves sources from ww3 p2l file as the equivalent vertical force on the seafloor.</span>
<span class="sd">    Saves in netcdf format the equivalent vertical force for each frequency if save argument is True.</span>
<span class="sd">    Plots in PNG source maps of P or S waves at given intervals depending on plot variables.</span>

<span class="sd">    Args:</span>
<span class="sd">        paths (list): [file_bathy, ww3_local_path]: paths of additional files bathymetry, ww3 p2l file</span>
<span class="sd">        dpt1 (xarray.DataArray): bathymetry grid in m (depth) with dimensions lon x lat</span>
<span class="sd">        zlon (xarray.DataArray): longitude of bathymetry file (°)</span>
<span class="sd">        zlat (xarray.DataArray): latitude of bathymetry file (°)</span>
<span class="sd">        date_vec (list, optional): date vector [year, month, day, hour], with hour in [0, 3, 6, 9, 12, 15, 18, 21]</span>
<span class="sd">        extent (list, optional): spatial extent format [lon_min, lon_max, lat_min, lat_max].</span>
<span class="sd">        parameters (list, optional): parameters minimum frequency, maximum frequency.</span>
<span class="sd">        c_file (str, optional): path to amplification coefficient file.</span>
<span class="sd">        prefix (str, optional): prefix of the ww3 p2l file.</span>
<span class="sd">        plot (bool, optional): plot maps.</span>
<span class="sd">        plot_hourly (bool, optional):  plot maps every 3-hours.</span>
<span class="sd">        plot_daily (bool, optional): plot maps every day.</span>
<span class="sd">        plot_monthly (bool, optional): plot maps every month.</span>
<span class="sd">        plot_yearly (bool, optional): plot map for the year average.</span>
<span class="sd">        save (bool, optional): save 3-hourly matrix.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_bathy</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ww3_local_path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Constants</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="mf">6.371</span><span class="o">*</span><span class="mf">1e6</span> <span class="c1"># radius of the earth in meters</span>
    <span class="n">lg10</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># log of 10</span>
    <span class="n">res_mod</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># angular resolution of the model</span>
    <span class="c1">#</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">## Initialize variables</span>
    <span class="k">if</span> <span class="s1">&#39;plot_type&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">plot_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;plot_type&#39;</span><span class="p">]</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;hourly&#39;</span><span class="p">:</span>
            <span class="n">plot_hourly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_hourly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_hourly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;daily&#39;</span><span class="p">:</span>
            <span class="n">plot_daily</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_daily</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_daily</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;monthly&#39;</span><span class="p">:</span>
            <span class="n">plot_monthly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_monthly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_monthly</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;yearly&#39;</span><span class="p">:</span>
            <span class="n">plot_yearly</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">F_yearly</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_yearly</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="s1">&#39;save&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;save&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">save</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="mf">1e10</span>

    <span class="c1">## Adapt latitude and longitude to values in parameters file</span>
    <span class="n">lon_min</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lon_max</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lat_min</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">lat_max</span> <span class="o">=</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
    <span class="n">zlat</span> <span class="o">=</span> <span class="n">zlat</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">))</span>
    <span class="n">zlon</span> <span class="o">=</span> <span class="n">zlon</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>

    <span class="c1">## Open Amplification Coefficient</span>
    <span class="c1"># check for refined bathymetry</span>
    <span class="n">res_bathy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">zlon</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zlon</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">res_bathy</span> <span class="o">==</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="s1">&#39;../../data/C.nc&#39;</span><span class="p">)</span>
        <span class="n">refined</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refined bathymetry grid </span><span class="se">\n</span><span class="s2"> PLEASE RUN amplification_coefficients.ipynb before running this script&quot;</span><span class="p">)</span>
        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">c_file</span><span class="p">)</span>
        <span class="n">refined</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">## Surface Element</span>
    <span class="n">msin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">zlat</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlon</span><span class="p">)))</span>
    <span class="n">res_mod</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zlat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">zlat</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">dA</span> <span class="o">=</span> <span class="n">radius</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">res_mod</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">msin</span><span class="p">,</span><span class="n">ones</span><span class="p">)</span>

    <span class="c1">## Loop over dates</span>
    <span class="n">YEAR</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">MONTH</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">DAY</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">date_vec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">iyear</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">YEAR</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">MONTH</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">MONTH</span><span class="p">])</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">MONTH</span><span class="p">):</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MONTH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">MONTH</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">imonth</span> <span class="ow">in</span> <span class="n">MONTH</span><span class="p">:</span>
            <span class="n">TOTAL_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># Initiate monthly source of Rayleigh wave matrix</span>
            <span class="n">daymax</span> <span class="o">=</span> <span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span><span class="n">imonth</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">filename_p2l</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">_</span><span class="si">%d%02d</span><span class="s1">_p2l.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ww3_local_path</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File WW3 &quot;</span><span class="p">,</span> <span class="n">filename_p2l</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">DAY</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">day</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">day</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">day</span><span class="o">==</span><span class="n">daymax</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">imonth</span> <span class="o">==</span> <span class="n">MONTH</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">[:</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">imonth</span> <span class="o">==</span> <span class="n">MONTH</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">day</span><span class="o">==</span><span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">day</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">day</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">daymax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">day</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">day</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">monthrange</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span><span class="n">imonth</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iday</span> <span class="ow">in</span> <span class="n">day</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">HOUR</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">HOUR</span><span class="p">])</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">HOUR</span><span class="p">):</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">HOUR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">HOUR</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ih</span> <span class="ow">in</span> <span class="n">HOUR</span><span class="p">:</span>

                    <span class="c1">## Open F_p3D </span>
                    <span class="p">(</span><span class="n">lati</span><span class="p">,</span> <span class="n">longi</span><span class="p">,</span> <span class="n">freq_ocean</span><span class="p">,</span> <span class="n">p2l</span><span class="p">,</span> <span class="n">unit1</span><span class="p">)</span> <span class="o">=</span> <span class="n">read_p2l</span><span class="p">(</span><span class="n">filename_p2l</span><span class="p">,</span> <span class="p">[</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">],</span> <span class="p">[</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">],</span> <span class="p">[</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">])</span>
                    <span class="n">nf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq_ocean</span><span class="p">)</span>  <span class="c1"># number of frequencies </span>
                    <span class="n">xfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">freq_ocean</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">freq_ocean</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">nf</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># determines the xfr geometric progression factor</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">freq_ocean</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xfr</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">xfr</span><span class="p">)</span>  <span class="c1"># frequency interval in wave model times 2</span>
                    <span class="n">freq_seismic</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">freq_ocean</span>  <span class="c1"># ocean to seismic waves freq</span>

                    <span class="c1">## Check units of the model, depends on version</span>
                    <span class="k">if</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(Pa2 m2 s+1E-12&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span>  <span class="o">-</span> <span class="p">(</span><span class="mf">1e-12</span><span class="o">-</span><span class="mf">1e-16</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(m4s+0.01&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.009999</span>
                    <span class="k">elif</span> <span class="n">unit1</span> <span class="o">==</span> <span class="s1">&#39;log10(Pa2 m2 s+1E-12)&#39;</span><span class="p">:</span>
                        <span class="n">p2l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lg10</span><span class="o">*</span><span class="n">p2l</span><span class="p">)</span>  <span class="o">-</span> <span class="p">(</span><span class="mf">1e-12</span><span class="o">-</span><span class="mf">1e-16</span><span class="p">)</span>

                    <span class="c1">## Integral over a frequency band  </span>
                    <span class="k">if</span> <span class="n">f1</span> <span class="o">&lt;</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">index_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">f1</span> <span class="o">&lt;=</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="n">freq_seismic</span> <span class="o">&lt;=</span> <span class="n">f2</span><span class="p">)</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">freq_seismic</span> <span class="o">=</span> <span class="n">freq_seismic</span><span class="p">[</span><span class="n">index_freq</span><span class="p">]</span>
                        <span class="n">n_freq</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">p2l</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq_ocean</span><span class="p">[</span><span class="n">index_freq</span><span class="p">],</span> <span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">Fp</span><span class="p">))</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">freq_seismic</span><span class="p">})</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">swap_dims</span><span class="p">({</span><span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;freq&quot;</span><span class="p">})</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">)</span>
                        <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="s2">&quot;frequency&quot;</span><span class="p">})</span>
                        <span class="n">res_p2l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Fp</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Fp</span><span class="o">.</span><span class="n">latitude</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">res_bathy</span> <span class="o">!=</span> <span class="n">res_p2l</span><span class="p">:</span>
                            <span class="c1"># interpolate Fp</span>
                            <span class="n">Fp</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">zlon</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">zlat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
                        <span class="c1">## Amplification coefficient</span>
                        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">amplification_coeff</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq_seismic</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
                        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">amplification_coeff</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
                        <span class="n">amplification_coeff</span> <span class="o">=</span> <span class="n">amplification_coeff</span><span class="o">.</span><span class="n">reindex_like</span><span class="p">(</span><span class="n">Fp</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
                        <span class="n">F_f</span> <span class="o">=</span> <span class="n">Fp</span><span class="o">*</span><span class="n">amplification_coeff</span><span class="o">**</span><span class="mi">2</span>
                        <span class="n">F</span> <span class="o">=</span> <span class="n">F_f</span>
                        <span class="k">for</span> <span class="n">ifq</span><span class="p">,</span> <span class="n">fq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq_seismic</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                            <span class="n">df_fq</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">ifq</span><span class="p">]</span>
                            <span class="n">F_fi</span> <span class="o">=</span> <span class="n">F_f</span><span class="p">[</span><span class="n">ifq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                            <span class="n">F_fi</span> <span class="o">*=</span> <span class="n">dA</span>
                            <span class="n">F</span><span class="p">[</span><span class="n">ifq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">F_fi</span><span class="o">*</span><span class="n">df_fq</span>
                        <span class="n">F</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="c1">## Single frequency</span>
                    <span class="k">elif</span> <span class="n">f1</span> <span class="o">==</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">index_freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">freq</span><span class="o">-</span><span class="n">f1</span><span class="p">)))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;unique frequency &#39;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1">## Exception in parametrization of frequencies</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;two frequencies with f2 &lt; f1 were given&#39;</span><span class="p">)</span>
                        <span class="k">return</span>

                    <span class="c1">## Save F to file</span>
                    <span class="k">if</span> <span class="n">save</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">path_out</span> <span class="o">=</span> <span class="s1">&#39;./F/&#39;</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_out</span><span class="p">):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;make directory </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">path_out</span><span class="p">)</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_out</span><span class="p">)</span>
                        <span class="c1"># Create netCDF 3-hourly file</span>
                        <span class="n">ncfile</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">path_out</span><span class="o">+</span><span class="s2">&quot;F_</span><span class="si">%d%02d%02d%02d</span><span class="s2">.nc&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4_CLASSIC&#39;</span><span class="p">)</span>
                        <span class="n">lat_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlat</span><span class="p">))</span>  <span class="c1"># latitude axis</span>
                        <span class="n">lon_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlon</span><span class="p">))</span>  <span class="c1"># longitude axis</span>
                        <span class="n">time_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">daymax</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># unlimited axis (can be appended to).</span>
                        <span class="n">freq_dim</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createDimension</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">n_freq</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Equivalent Vertical Force on </span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;Equivalent Force every 3 hours for the secondary microseismic peak&#39;</span>
                        <span class="n">lat</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">,))</span>
                        <span class="n">lat</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_north&#39;</span>
                        <span class="n">lat</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span>
                        <span class="n">lon</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">,))</span>
                        <span class="n">lon</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;degrees_east&#39;</span>
                        <span class="n">lon</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span>
                        <span class="n">time</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;hours since 1990-01-01&#39;</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
                        <span class="n">freq_nc</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,))</span>
                        <span class="n">freq_nc</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;Hz&#39;</span>
                        <span class="n">freq_nc</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span>
                        <span class="n">F_freq</span> <span class="o">=</span> <span class="n">ncfile</span><span class="o">.</span><span class="n">createVariable</span><span class="p">(</span><span class="s1">&#39;F_f&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">))</span>
                        <span class="n">F_freq</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;N.s^{1/2}&#39;</span>
                        <span class="n">F_freq</span><span class="o">.</span><span class="n">long_name</span> <span class="o">=</span> <span class="s1">&#39;Equivalent Vertical Force spectrum&#39;</span>
                        <span class="n">lat</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zlat</span>
                        <span class="n">lon</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zlon</span>
                        <span class="n">freq_nc</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">freq_seismic</span>
                        <span class="n">F_freq</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">F_f</span>
                        <span class="n">time</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">date2num</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;hours since 1990-01-01&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">)</span>
                        <span class="n">ncfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                    <span class="c1">## Plot F</span>
                    <span class="k">if</span> <span class="n">plot_hourly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> 
                        <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> 
                                                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                                <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                                                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Equivalent Force. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">))</span>
                        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Equivalent Force. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">))</span>
                        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                        <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                        <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                        <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_R_</span><span class="si">%d%02d%02d</span><span class="s1">T</span><span class="si">%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">,</span> <span class="n">ih</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

                    <span class="c1">## Sum F</span>
                    <span class="k">if</span> <span class="n">plot_daily</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">F_daily</span> <span class="o">+=</span> <span class="n">F</span>
                    <span class="k">if</span> <span class="n">plot_monthly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">F_monthly</span> <span class="o">+=</span> <span class="n">F</span>
                    <span class="k">if</span> <span class="n">plot_yearly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">F_yearly</span> <span class="o">+=</span> <span class="n">F</span>

                <span class="k">if</span> <span class="n">plot_daily</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> 
                    <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F_daily</span><span class="p">,</span> 
                        <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                        <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Equivalent Force. Rayleigh waves.Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">))</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Equivalent Force. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">))</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                    <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                    <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_R_</span><span class="si">%d%02d%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">,</span> <span class="n">iday</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                    <span class="n">F_daily</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">plot_monthly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F_monthly</span><span class="p">,</span> 
                    <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                    <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Equivalent Force. Rayleigh waves. Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">))</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Equivalent Force. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">-</span><span class="si">%02d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">))</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
                <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
                <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
                <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
                <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_R_</span><span class="si">%d%02d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">,</span> <span class="n">imonth</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
                <span class="n">F_monthly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>


        <span class="k">if</span> <span class="n">plot_yearly</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
            <span class="n">F_plot</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">F_yearly</span><span class="p">,</span>
                                <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span><span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">},</span> 
                                <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Equivalent Force. </span><span class="si">%s</span><span class="s1"> waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">))</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Equivalent Force. Rayleigh waves.</span><span class="se">\n</span><span class="s1">Frequency </span><span class="si">%.3f</span><span class="s1">-</span><span class="si">%.3f</span><span class="s1"> Hz.</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">iyear</span><span class="p">))</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;linen&#39;</span><span class="p">)</span>
            <span class="n">F_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>  <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;F (N)&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">:</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;F_R_</span><span class="si">%d</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iyear</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
            <span class="n">F_daily</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">F_yearly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dpt1</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Equivalent Vertical Force source maps done!&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_rayleigh_waves.open_bathy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">open_bathy</span><span class="p">(</span><span class="n">file_bathy</span><span class="o">=</span><span class="s1">&#39;../../data/WW3-GLOB-30M_202002_p2l.nc&#39;</span><span class="p">,</span> <span class="n">refined_bathymetry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Open bathymetry file and optionally refine bathymetry using ETOPOv2 dataset. </p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_bathy</code></b>
                  (<code>str</code>, default:
                      <code>&#39;../../data/WW3-GLOB-30M_202002_p2l.nc&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Path to the bathymetry file.</p>
              </div>
            </li>
            <li>
              <b><code>refined_bathymetry</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether to use the refined ETOPOv2 dataset.</p>
              </div>
            </li>
            <li>
              <b><code>extent</code></b>
                  (<code>list</code>, default:
                      <code>[-180, 180, -90, 90]</code>
)
              –
              <div class="doc-md-description">
                <p>The geographical extent of the bathymetry data in the format [lon_min, lon_max, lat_min, lat_max].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dpt1_mask</code></b>(                  <code><span title="xarray.DataArray">DataArray</span></code>
)              –
              <div class="doc-md-description">
                <p>Masked bathymetry data.</p>
              </div>
            </li>
            <li>
<b><code>zlon</code></b>(                  <code><span title="xarray.DataArray">DataArray</span></code>
)              –
              <div class="doc-md-description">
                <p>Longitude coordinates.</p>
              </div>
            </li>
            <li>
<b><code>zlat</code></b>(                  <code><span title="xarray.DataArray">DataArray</span></code>
)              –
              <div class="doc-md-description">
                <p>Latitude coordinates.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_rayleigh_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">open_bathy</span><span class="p">(</span><span class="n">file_bathy</span> <span class="o">=</span> <span class="s1">&#39;../../data/WW3-GLOB-30M_202002_p2l.nc&#39;</span><span class="p">,</span> <span class="n">refined_bathymetry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Open bathymetry file and optionally refine bathymetry using ETOPOv2 dataset. </span>

<span class="sd">    Args:</span>
<span class="sd">        file_bathy (str, optional): Path to the bathymetry file.</span>
<span class="sd">        refined_bathymetry (bool, optional): Whether to use the refined ETOPOv2 dataset.</span>
<span class="sd">        extent (list, optional): The geographical extent of the bathymetry data in the format [lon_min, lon_max, lat_min, lat_max].</span>

<span class="sd">    Returns:</span>
<span class="sd">        dpt1_mask (xarray.DataArray): Masked bathymetry data.</span>
<span class="sd">        zlon (xarray.DataArray): Longitude coordinates.</span>
<span class="sd">        zlat (xarray.DataArray): Latitude coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">[</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">]</span> <span class="o">=</span> <span class="n">extent</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">file_bathy</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;dpt&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dpt1</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">refined_bathymetry</span> <span class="ow">or</span> <span class="n">file_bathy</span> <span class="o">==</span> <span class="s1">&#39;../../data/ETOPO_2022_v1_60s_N90W180_bed.nc&#39;</span><span class="p">:</span>
        <span class="c1"># load refined bathymetry ETOPOv2</span>
        <span class="n">file_bathy</span> <span class="o">=</span> <span class="s1">&#39;../../data/ETOPO_2022_v1_60s_N90W180_bed.nc&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">file_bathy</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
            <span class="n">ds</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;latitude&#39;</span><span class="p">})</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
            <span class="n">z</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># ETOPOv2 to Depth</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">dpt1</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">),</span> <span class="n">longitude</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">))</span>         
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refined bathymetry ETOPOv2 not found. </span><span class="se">\n</span><span class="s2">You can download it from:</span><span class="se">\n</span><span class="s2"> https://www.ngdc.noaa.gov/thredds/catalog/global/ETOPO2022/60s/60s_bed_elev_netcdf/catalog.html?dataset=globalDatasetScan/ETOPO2022/60s/60s_bed_elev_netcdf/ETOPO_2022_v1_60s_N90W180_bed.nc</span><span class="se">\n</span><span class="s2">Save in ../data/&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="c1">## Mask nan values    </span>
    <span class="n">dpt1_mask</span> <span class="o">=</span> <span class="n">dpt1</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dpt1</span><span class="p">))</span>
    <span class="n">zlon</span> <span class="o">=</span> <span class="n">dpt1_mask</span><span class="o">.</span><span class="n">longitude</span>
    <span class="n">zlat</span> <span class="o">=</span> <span class="n">dpt1_mask</span><span class="o">.</span><span class="n">latitude</span>
    <span class="k">return</span> <span class="n">dpt1_mask</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">zlat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_rayleigh_waves.site_effect" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">site_effect</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">vs_crust</span><span class="o">=</span><span class="mf">2.8</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;../../data/longuet_higgins.txt&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Bathymetry secondary microseismic excitation coefficients (Rayleigh waves).</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>z</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>thickness of water layer.</p>
              </div>
            </li>
            <li>
              <b><code>f</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>seismic frequency in Hertz.</p>
              </div>
            </li>
            <li>
              <b><code>vs_crust</code></b>
                  (<code>float</code>, default:
                      <code>2.8</code>
)
              –
              <div class="doc-md-description">
                <p>shear waves velocity in the crust (sea bed).</p>
              </div>
            </li>
            <li>
              <b><code>path</code></b>
                  (<code>str</code>, default:
                      <code>&#39;../../data/longuet_higgins.txt&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>the path to the Longuet Higgins file containing tabulated values of site effect coefficient for the 4th first modes.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>C</code></b>(                  <code><span title="numpy.ndarray">ndarray</span></code>
)              –
              <div class="doc-md-description">
                <p>Numerical value of the site effect in the shape (f.shape, z.shape).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_rayleigh_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">site_effect</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">zlat</span><span class="p">,</span> <span class="n">zlon</span><span class="p">,</span> <span class="n">vs_crust</span><span class="o">=</span><span class="mf">2.8</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;../../data/longuet_higgins.txt&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Bathymetry secondary microseismic excitation coefficients (Rayleigh waves).</span>

<span class="sd">    Args:</span>
<span class="sd">        z (np.ndarray): thickness of water layer.</span>
<span class="sd">        f (np.ndarray): seismic frequency in Hertz.</span>
<span class="sd">        vs_crust (float, optional): shear waves velocity in the crust (sea bed).</span>
<span class="sd">        path (str, optional): the path to the Longuet Higgins file containing tabulated values of site effect coefficient for the 4th first modes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        C (np.ndarray): Numerical value of the site effect in the shape (f.shape, z.shape).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fh1&#39;</span><span class="p">,</span> <span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;fh2&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">,</span> <span class="s1">&#39;fh3&#39;</span><span class="p">,</span> <span class="s1">&#39;c3&#39;</span><span class="p">,</span> <span class="s1">&#39;fh4&#39;</span><span class="p">,</span> <span class="s1">&#39;c4&#39;</span><span class="p">])</span>
    <span class="n">fc1</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fh1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">c1</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fc2</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fh2</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">c2</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fc3</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fh3</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">c3</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">fc4</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">fh4</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">c4</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">try</span> <span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">fh_v</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fq</span><span class="o">*</span><span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">vs_crust</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
            <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fc1</span><span class="p">(</span><span class="n">fh_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">fc2</span><span class="p">(</span><span class="n">fh_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">fc3</span><span class="p">(</span><span class="n">fh_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">fc4</span><span class="p">(</span><span class="n">fh_v</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="c1">## C to xarray</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;frequency&#39;</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">zlat</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">zlon</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">C</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="wmsan.subfunctions_rayleigh_waves.spectrogram" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">spectrogram</span><span class="p">(</span><span class="n">path_netcdf</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">lon_sta</span><span class="o">=-</span><span class="mf">21.3268</span><span class="p">,</span> <span class="n">lat_sta</span><span class="o">=</span><span class="mf">64.7474</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Plot spectrogram for a given path to NetCDF file, dates, and optional station coordinates and constants.
Attenuation Quality Factor used in Ardhuin et al. (2011) for
KIP (Hawaii) few reflections old crust, Q=580</p>
<p>BORG (Iceland) few reflection young crust, Q=200</p>
<p>BKS (California USA), Q=88</p>
<p>SSB (France) respectively, Q=260</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>path_netcdf</code></b>
                  (<code>str</code>)
              –
              <div class="doc-md-description">
                <p>path to NetCDF file containing the power spectrum of vertical displacement (m.s).</p>
              </div>
            </li>
            <li>
              <b><code>dates</code></b>
                  (<code>list or array - like</code>)
              –
              <div class="doc-md-description">
                <p>dates for which to calculate the spectrogram.</p>
              </div>
            </li>
            <li>
              <b><code>lon_sta</code></b>
                  (<code>float</code>, default:
                      <code>-21.3268</code>
)
              –
              <div class="doc-md-description">
                <p>longitude of the station.</p>
              </div>
            </li>
            <li>
              <b><code>lat_sta</code></b>
                  (<code>float</code>, default:
                      <code>64.7474</code>
)
              –
              <div class="doc-md-description">
                <p>latitude of the station.</p>
              </div>
            </li>
            <li>
              <b><code>Q</code></b>
                  (<code>int</code>, default:
                      <code>200</code>
)
              –
              <div class="doc-md-description">
                <p>attenuation factor constant.</p>
              </div>
            </li>
            <li>
              <b><code>U</code></b>
                  (<code>int</code>, default:
                      <code>1800</code>
)
              –
              <div class="doc-md-description">
                <p>group velocity of Rayleigh waves constant.</p>
              </div>
            </li>
            <li>
              <b><code>P</code></b>
                  (<code>int</code>, default:
                      <code>1</code>
)
              –
              <div class="doc-md-description">
                <p>3D propagation effect constant from Stutzmann et al. (2012).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>wmsan/subfunctions_rayleigh_waves.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">spectrogram</span><span class="p">(</span><span class="n">path_netcdf</span><span class="p">,</span> <span class="n">dates</span><span class="p">,</span> <span class="n">lon_sta</span><span class="o">=-</span><span class="mf">21.3268</span><span class="p">,</span> <span class="n">lat_sta</span><span class="o">=</span><span class="mf">64.7474</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mi">1800</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot spectrogram for a given path to NetCDF file, dates, and optional station coordinates and constants.</span>
<span class="sd">    Attenuation Quality Factor used in Ardhuin et al. (2011) for</span>
<span class="sd">    KIP (Hawaii) few reflections old crust, Q=580</span>

<span class="sd">    BORG (Iceland) few reflection young crust, Q=200</span>

<span class="sd">    BKS (California USA), Q=88</span>

<span class="sd">    SSB (France) respectively, Q=260</span>

<span class="sd">    Args:</span>
<span class="sd">        path_netcdf (str): path to NetCDF file containing the power spectrum of vertical displacement (m.s).</span>
<span class="sd">        dates (list or array-like): dates for which to calculate the spectrogram.</span>
<span class="sd">        lon_sta (float, optional): longitude of the station.</span>
<span class="sd">        lat_sta (float, optional): latitude of the station.</span>
<span class="sd">        Q (int, optional): attenuation factor constant.</span>
<span class="sd">        U (int, optional): group velocity of Rayleigh waves constant.</span>
<span class="sd">        P (int, optional): 3D propagation effect constant from Stutzmann et al. (2012).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>

    <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">150</span>
    <span class="c1">## Constants</span>
    <span class="n">radius_earth</span> <span class="o">=</span> <span class="mf">6371e3</span>  <span class="c1"># m</span>
    <span class="n">res_mod</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># resolution ww3 model</span>

    <span class="c1"># open NetCDF for dims</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">month</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">day</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hour</span>

    <span class="n">file_netcdf</span> <span class="o">=</span> <span class="n">path_netcdf</span> <span class="o">+</span> <span class="s1">&#39;rayleigh_SDF_</span><span class="si">%d%02d%02d%02d</span><span class="s1">.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
    <span class="n">dset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">file_netcdf</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
    <span class="n">zlon</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">longitude</span>
    <span class="n">zlat</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">latitude</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">frequency</span>

    <span class="c1"># calculate spherical surface elementary elements</span>
    <span class="n">msin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">zlat</span><span class="p">))])</span><span class="o">.</span><span class="n">T</span>
    <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">zlon</span><span class="p">)))</span>
    <span class="n">dA</span> <span class="o">=</span> <span class="n">radius_earth</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">res_mod</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">msin</span><span class="p">,</span><span class="n">ones</span><span class="p">)</span>

    <span class="c1"># Compute distance of each gridpoint to station</span>
    <span class="n">geoid</span> <span class="o">=</span> <span class="n">Geod</span><span class="p">(</span><span class="n">ellps</span><span class="o">=</span><span class="s1">&#39;WGS84&#39;</span><span class="p">)</span>
    <span class="n">lat_grid</span><span class="p">,</span> <span class="n">lon_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">zlat</span><span class="p">,</span> <span class="n">zlon</span><span class="p">)</span>
    <span class="n">lon_STA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">lon_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">*</span><span class="n">lon_sta</span>
    <span class="n">lat_STA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">lat_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">*</span><span class="n">lat_sta</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">distance_in_m</span> <span class="o">=</span> <span class="n">geoid</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">lon_STA</span><span class="p">,</span> <span class="n">lat_STA</span><span class="p">,</span> <span class="n">lon_grid</span><span class="p">,</span> <span class="n">lat_grid</span><span class="p">)</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_in_m</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">radius_earth</span><span class="p">)</span>
    <span class="c1"># Initiate spectrogram</span>
    <span class="n">n_dates</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dates</span><span class="p">)</span>
    <span class="n">spectro</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_dates</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)))</span>

    <span class="c1">## Loop Over Dates</span>
    <span class="k">for</span> <span class="n">idate</span><span class="p">,</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">dates</span><span class="p">)):</span>

        <span class="c1">## Open the netCDF File</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">year</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">month</span>
        <span class="n">day</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">day</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">hour</span>

        <span class="n">file_netcdf</span> <span class="o">=</span> <span class="n">path_netcdf</span> <span class="o">+</span> <span class="s1">&#39;rayleigh_SDF_</span><span class="si">%d%02d%02d%02d</span><span class="s1">.nc&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">file_netcdf</span><span class="p">,</span> <span class="n">combine</span><span class="o">=</span><span class="s1">&#39;by_coords&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File </span><span class="si">%s</span><span class="s2"> does not exist&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">file_netcdf</span><span class="p">))</span>
            <span class="k">continue</span>
        <span class="c1">## Compute RMS Displacement</span>
        <span class="n">sdf_f</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sdf_f</span>
        <span class="n">F_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sdf_f</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">ifreq</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">freq</span><span class="p">):</span>
            <span class="n">SDF_freq</span> <span class="o">=</span> <span class="n">sdf_f</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">ifreq</span><span class="p">])</span><span class="o">.</span><span class="n">data</span>
            <span class="n">EXP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="o">*</span><span class="n">radius_earth</span><span class="o">/</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">Q</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">distance</span><span class="p">))</span>
            <span class="n">denominateur</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">radius_earth</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">distance</span><span class="p">)))</span>
            <span class="n">facteur</span> <span class="o">=</span> <span class="n">EXP</span><span class="o">*</span><span class="n">denominateur</span>
            <span class="n">F_delta</span><span class="p">[</span><span class="n">ifreq</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">facteur</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">SDF_freq</span><span class="o">*</span><span class="n">dA</span><span class="o">*</span><span class="n">P</span>
        <span class="n">disp_RMS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">F_delta</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))))</span>
        <span class="n">spectro</span><span class="p">[</span><span class="n">idate</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">disp_RMS</span>

    <span class="c1">## Plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;spectrogram&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">spectro</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Spectral_r&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date &#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$m^2/Hz$ [dB]&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;spectrogram_ww3.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dates</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">spectro</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../body_waves/" class="btn btn-neutral float-left" title="Body Waves"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../temporal_variations/" class="btn btn-neutral float-right" title="Temporal Variations">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://gricad-gitlab.univ-grenoble-alpes.fr/tomasetl/ww3-source-maps" class="icon icon-gitlab" style="color: #fcfcfc"> GitLab</a>
        </span>
    
    
      <span><a href="../body_waves/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../temporal_variations/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
